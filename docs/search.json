[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Innovalab",
    "section": "",
    "text": "Hello and welcome to\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWorkfields\n\n\nI enjoy exploring open datasets and pick up new and tricks on my way.I share what I discover and learn.\n\nStart reading\n\n\n\n\n\n\n\nStatistic models\n\n\nA gallery of contributions to dataviz challenges, such as #TidyTuesday or #30DayChartChallenge\n\nBrowse\n\n\n\n\n\n\n\nData visualization\n\n\nA collection of ongoing personal data-endeavors and programming projects.\n\n Take me there"
  },
  {
    "objectID": "methodology.html#intro",
    "href": "methodology.html#intro",
    "title": "Stratification and sampling️ of population centers in Loreto, Peru 🎲✨",
    "section": "1 Introduction",
    "text": "1 Introduction\nThis document describes the methodology carried out for the stratification and selection of population centers in Loreto for drone surveillance. This activity is part of the the Harmonize project: Harmonisation of spatio-temporal multi-scale data for health in climate change hotspots in the Peruvian Amazon (SIDISI 209821), in collaboration with the Barcelona Supercomputing Center.\nThe Harmonize project has the following objectives:\n\nGeo-location of cases collected by passive surveillance from the Peruvian Ministry of Health (MINSA) through the Center for Disease Control and Prevention (CDC-Peru) in the study area using GPS devices.\nIdentify potential mosquito breeding sites based on new longitudinal ground survey data and using drone surveillance.\nCollect data from weather stations, satellite imagery, ambient acoustic sounds and air pollution to calibrate and reduce the spatial resolution of Earth observation data sets.\nDetermine the impact of the use of these new technologies on infectious disease reduction interventions carried out by the Dirección Regional de Salud (DIRESA) of Loreto.\n\nThe methodology described here corresponds to the second objective above. Since we cannot map the whole study area of Loreto, our approach was to characterize the population centers in Loreto according to the incidence of relevant diseases in the area (Malaria, Dengue and Leptospirosis) and meteorological, environmental and human intervention variables (temperature, precipitation, soil moisture, deforestation, etc.) and then use this variables to create sampling strata using clustering techniques. Finally, we randomly sampled a number of the population centers from each stratum proportional to the stratum size."
  },
  {
    "objectID": "methodology.html#dataset",
    "href": "methodology.html#dataset",
    "title": "Stratification and sampling️ of population centers in Loreto, Peru 🎲✨",
    "section": "2 Dataset",
    "text": "2 Dataset\nFor each population center, we gathered records on the following fields:\n\nUBIGEO, which is the official identification code of the population centers used by the Instituto Nacional de Estadística e Informática (INEI).\nOfficial name .\nLatitude and longitud.\nCumulative incidence of malaria, dengue and leptospirosis from epidemiological week 1 to 39 of 2022.\nMean and difference of the annual mean values of the years 2010 and 2021 of the following variables:\n\nPrecipitation accumulation (mm),\nRunoff (mm),\nSoil moisture (mm),\nMaximum temperature (°C),\nMinimum temperature (°C),\nTotal evapotranspiration (kg/m2),\nSpecific humidity (kg/kg),\nDeforestation area (km2).\n\nMean and difference of the annual values of the years 2010 and 2020 of the following variables:\n\nPopulation density from WorldPop and\nHuman settlement data from the Global Human Settlement Layer (GHSL).\n\nMean and difference of the annual mean values from years 2014 and 2021 of the nighttime data from the Visible Infrared Imaging Radiometer Suite (VIIRS).\n\nWe can take a look at the data in the following table:\n\n\n\n\n\nShow code\ndataset %>% \n  mutate(across(where(is.numeric), ~ round(.x, 2))) %>% \n  DT::datatable(\n    options = list(display = \"compact\", pageLength = 5, scrollX = TRUE)\n  )"
  },
  {
    "objectID": "methodology.html#stratification",
    "href": "methodology.html#stratification",
    "title": "Stratification and sampling️ of population centers in Loreto, Peru 🎲✨",
    "section": "3 Stratification",
    "text": "3 Stratification\nThe stratification of the population centers consisted of using the meteorological, environmental and human intervention variables to built groups of population centers with homogeneous characteristics. For this purpose, we tested two approaches. The first one consisted of performing an agglomerative (“bottom-up”) hierarchical clustering analysis using different distances, linkage methods, and number of clusters selection methods. On the second one, we used Principal Component Analysis (PCA) to reduce the dimension of the variables to one principal dimension and used it’s scores to create groups by quantile classification.\n\n3.0.1 Hierarchical clustering\n\n\n\n\n\n\n\n\nShow code\ndist_euclidean_norm = get_dist(variables_norm, method = \"euclidean\")\ndist_pearson_norm = get_dist(variables_norm, method = \"pearson\")\ndist_spearman_norm = get_dist(variables_norm, method = \"spearman\")\ndist_euclidean_std = get_dist(variables_std, method = \"euclidean\")\ndist_pearson_std = get_dist(variables_std, method = \"pearson\")\ndist_spearman_std = get_dist(variables_std, method = \"spearman\")\n\n\n\n\n3.1 🔵 Heatmaps\n\n3.1.1 Normalization\n\nEuclidean distancePearson correlationSpearman correlation\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3.1.2 Standardization\n\nEuclidean distancePearson correlationSpearman correlation\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3.2 🔵 Selection of distance and linkage method\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nShow code\nagglomerative_coeff %>% \n  select(-c(data, scaling, dist_mat, tree)) %>% \n  DT::datatable()\n\n\n\n\n\n\n\n\n3.2.1 Dendograms\n\nStandardization, Spearman correlation, Ward linkageNormalization, Pearson correlation, Ward linkage\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3.3 🔵 Selection of number of clusters\nSelection of the number of clusters: The criteria of average silhouette width, total within sum of squares and gap statistic were used to select the number of clusters. Dimension reduction (PCA) was also used to visualize the data in 2 dimensions for different numbers of clusters and to evaluate how well the groups were formed. Furthermore, for different numbers of clusters, the differences between the means of the variables in different clusters were explored for cluster interpretability. Finally, the individual silhouette of each observation was evaluated for different numbers of clusters to assess whether the observations were well grouped. The final selection was made by evaluating all these criteria and selecting the most suitable number of clusters for the application.\n\n3.3.1 Evaluation of criteria\n\n3.3.1.1 Standardization, Spearman correlation, Ward linkage\n\nAverage silhouette widthTotal within sum of squaresGap statistic\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3.3.1.2 Normalization, Pearson correlation, Ward linkage\n\nAverage silhouette widthTotal within sum of squaresGap statistic\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3.3.2 Evaluation of cluster sizes\n\n3.3.2.1 2 clusters\n\n\nShow code\nclustering_2 = hcut(\n  variables_std, k = 2, hc_func = \"agnes\", hc_method = \"ward.D2\", \n  hc_metric = \"spearman\"\n)\n\n\n\nClusters on planeIndividual silhouetteMean difference between clusters\n\n\n\n\n\n\n\n\n\n\n\n  cluster size ave.sil.width\n1       1   25          0.50\n2       2   31          0.48\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3.3.2.2 3 clusters\n\n\nShow code\nclustering_3 = hcut(\n  variables_std, k = 3, hc_func = \"agnes\", hc_method = \"ward.D2\", \n  hc_metric = \"spearman\"\n)\n\n\n\nClusters on planeIndividual silhouetteMean difference between clusters\n\n\n\n\n\n\n\n\n\n\n\n  cluster size ave.sil.width\n1       1   25          0.38\n2       2   13          0.27\n3       3   18          0.63\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3.3.2.3 4 clusters\n\n\nShow code\nclustering_4 = hcut(\n  variables_std, k = 4, hc_func = \"agnes\", hc_method = \"ward.D2\", \n  hc_metric = \"spearman\"\n)\n\n\n\nClusters on planeIndividual silhouetteMean difference between clusters\n\n\n\n\n\n\n\n\n\n\n\n  cluster size ave.sil.width\n1       1    9          0.72\n2       2   16          0.24\n3       3   13          0.23\n4       4   18          0.63\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3.4 🔵 Maps\n\n\nShow code\ndataset_clustering = dataset %>% \n  mutate(\n    hc_group_2 = as.factor(clustering_2$cluster),\n    hc_group_3 = as.factor(clustering_3$cluster),\n    hc_group_4 = as.factor(clustering_4$cluster)\n  )\n\n\n\n2 clusters3 clusters4 clusters\n\n\n\n\n\n\n\n\n\n\n\n\nWarning: Unknown or uninitialised column: `village`.\n\n\n\n\n\n\n\n\n\n\nWarning: Unknown or uninitialised column: `village`.\n\n\n\n\n\n\n\n\n\n\n\n3.5 🔵 Principal components analysis\nThe communities were also tested for clustering using the principal component that best explained the variability of the variables used (first component). The scores of this component were divided into different categories given by the quantiles. Three forms of clustering were tested: 2 groups with the 50% quantile, 3 groups with the 33% and 66% quantiles, and 4 groups with the 25%, 50% and 75% quantiles.\n\n\nShow code\npca = PCA(variables_std, graph = FALSE)\n\n\n\n3.5.1 Scree plot\n\n\nShow code\nfviz_screeplot(pca)\n\n\n\n\n\n\n\n3.5.2 Contribution plot\n\nDimension 1Dimension 2\n\n\n\n\nShow code\nfviz_contrib(pca, choice = \"var\", axes = 1, top = 10)\n\n\n\n\n\n\n\n\n\nShow code\nfviz_contrib(pca, choice = \"var\", axes = 2, top = 10)\n\n\n\n\n\n\n\n\n\n\n\n3.6 🔵 Coordinate plane\n\n\nShow code\nfviz_pca_ind(pca)\n\n\n\n\n\n\n\n3.7 🔵 Maps\n\n\nShow code\npca_results = get_pca_ind(pca)\nscores = pca_results$coord\n\n\n\n\nShow code\ndataset_pca = dataset_clustering %>% \n  mutate(pca_score = scores[, 1]) %>% \n  mutate(\n    pca_group_2 = cut(\n      pca_score, breaks = quantile(pca_score, c(0, .5, 1)), \n      labels = as.character(rev(1:2)),\n      include.lowest = TRUE\n    ),\n    pca_group_3 = cut(\n      pca_score, breaks = quantile(pca_score, c(0, .33, .66, 1)), \n      labels = as.character(rev(1:3)),\n      include.lowest = TRUE\n    ),\n    pca_group_4 = cut(\n      pca_score, breaks = quantile(pca_score, c(0, .25, .5, .75, 1)), \n      labels = as.character(rev(1:4)),\n      include.lowest = TRUE\n    )\n  ) %>% \n  mutate(across(pca_group_2:pca_group_4, forcats::fct_rev))\n\n\n\n2 groups3 groups4 groups\n\n\n\n\nShow code\npaleta = colorFactor(palette = \"viridis\",domain = dataset_pca$pca_group_2)\ndataset_pca %>% \n  st_as_sf(coords = c(\"lon\", \"lat\"),crs=4326) %>%\n  leaflet() %>% \n  addTiles(group = \"OpenStreetMap\") %>% \n  addProviderTiles(provider = providers$CartoDB,group = \"CartoDB\") %>%\n  addProviderTiles(provider = providers$Esri.WorldImagery,group = \"Satelital\") %>% \n  addCircleMarkers(\n    popup = dataset_pca$village,\n    color = ~paleta(pca_group_2),\n    opacity = 1,\n    radius = 0.1,\n    fillOpacity = 0.5\n    )%>% \n  addLayersControl(\n    baseGroups = c(\"CartoDB\",\"OpenStreetMap\",\"Satelital\")\n    ) %>% \n  addLegend(\n    title = \"Cluster\",\n    pal = paleta,\n    values = ~pca_group_2,\n    opacity = 1,\n    position = \"bottomright\"\n    )\n\n\nWarning: Unknown or uninitialised column: `village`.\n\n\n\n\n\n\n\n\n\n\nShow code\npaleta = colorFactor(palette = \"viridis\",domain = dataset_pca$pca_group_3)\ndataset_pca %>% \n  st_as_sf(coords = c(\"lon\", \"lat\"),crs=4326) %>%\n  leaflet() %>% \n  addTiles(group = \"OpenStreetMap\") %>% \n  addProviderTiles(provider = providers$CartoDB,group = \"CartoDB\") %>%\n  addProviderTiles(provider = providers$Esri.WorldImagery,group = \"Satelital\") %>% \n  addCircleMarkers(\n    popup = dataset_pca$village,\n    color = ~paleta(pca_group_3),\n    opacity = 1,\n    radius = 0.1,\n    fillOpacity = 0.5\n    )%>% \n  addLayersControl(\n    baseGroups = c(\"CartoDB\",\"OpenStreetMap\",\"Satelital\")\n    ) %>% \n  addLegend(\n    title = \"Cluster\",\n    pal = paleta,\n    values = ~pca_group_3,\n    opacity = 1,\n    position = \"bottomright\"\n    )\n\n\nWarning: Unknown or uninitialised column: `village`.\n\n\n\n\n\n\n\n\n\n\nShow code\npaleta = colorFactor(palette = \"viridis\",domain = dataset_pca$pca_group_4)\ndataset_pca %>% \n  st_as_sf(coords = c(\"lon\", \"lat\"),crs=4326) %>%\n  leaflet() %>% \n  addTiles(group = \"OpenStreetMap\") %>% \n  addProviderTiles(provider = providers$CartoDB,group = \"CartoDB\") %>%\n  addProviderTiles(provider = providers$Esri.WorldImagery,group = \"Satelital\") %>% \n  addCircleMarkers(\n    popup = dataset_pca$village,\n    color = ~paleta(pca_group_4),\n    opacity = 1,\n    radius = 0.1,\n    fillOpacity = 0.5\n    )%>% \n  addLayersControl(\n    baseGroups = c(\"CartoDB\",\"OpenStreetMap\",\"Satelital\")\n    ) %>% \n  addLegend(\n    title = \"Cluster\",\n    pal = paleta,\n    values = ~pca_group_4,\n    opacity = 1,\n    position = \"bottomright\"\n    )\n\n\nWarning: Unknown or uninitialised column: `village`.\n\n\n\n\n\n\n\n\n\n\n\n3.8 🔵 Comparison\nComparison between clustering and PCA: We assessed how well the clustering matched using agglomerative clustering and PCA for 2, 3 and 4 groups. Confusion matrices and the Kappa statistic were used to assess clustering agreement.\n\n3.8.1 2 groups\n\n\nShow code\ndataset_pca %>% \n  conf_mat(hc_group_2, pca_group_2, dnn = c(\"PCA\", \"HC\"))\n\n\n   HC\nPCA  1  2\n  1 25  3\n  2  0 28\n\n\n\n\nShow code\ndataset_pca %>% \n  kap(hc_group_2, pca_group_2)\n\n\n# A tibble: 1 × 3\n  .metric .estimator .estimate\n  <chr>   <chr>          <dbl>\n1 kap     binary         0.893\n\n\n\n\n3.8.2 3 groups\n\n\nShow code\ndataset_pca %>% \n  conf_mat(hc_group_3, pca_group_3, dnn = c(\"PCA\", \"HC\"))\n\n\n   HC\nPCA  1  2  3\n  1 19  0  0\n  2  6 10  2\n  3  0  3 16\n\n\n\n\nShow code\ndataset_pca %>% \n  kap(hc_group_3, pca_group_3)\n\n\n# A tibble: 1 × 3\n  .metric .estimator .estimate\n  <chr>   <chr>          <dbl>\n1 kap     multiclass     0.705\n\n\n\n\n3.8.3 4 groups\n\n\nShow code\ndataset_pca %>% \n  conf_mat(hc_group_4, pca_group_4, dnn = c(\"PCA\", \"HC\"))\n\n\n   HC\nPCA  1  2  3  4\n  1  9  5  0  0\n  2  0 11  3  0\n  3  0  0  9  5\n  4  0  0  1 13\n\n\n\n\nShow code\ndataset_pca %>% \n  kap(hc_group_4, pca_group_4)\n\n\n# A tibble: 1 × 3\n  .metric .estimator .estimate\n  <chr>   <chr>          <dbl>\n1 kap     multiclass     0.667"
  },
  {
    "objectID": "methodology.html#sampling",
    "href": "methodology.html#sampling",
    "title": "Stratification and sampling️ of population centers in Loreto, Peru 🎲✨",
    "section": "4 Sampling",
    "text": "4 Sampling\nSelection of the sample of communities: Having chosen the number of clusters, random sampling proceeded within each cluster proportional to the cluster size.\n\n\nShow code\nset.seed(2022)\nsampling_20 = dataset_pca %>% \n  group_by(hc_group_2) %>% \n  slice_sample(prop = signif(20/56, 1)) %>% \n  ungroup()\n\nset.seed(2022)\nsampling_10 = dataset_pca %>% \n  group_by(hc_group_2) %>% \n  slice_sample(prop = signif(10/56, 1)) %>% \n  ungroup()\n\n\n\n\nShow code\nfull_dataset = dataset_pca %>% \n  st_as_sf(coords = c(\"lon\", \"lat\"))\nsample_10_dataset = sampling_10 %>% \n  st_as_sf(coords = c(\"lon\", \"lat\"))\nsample_20_dataset = sampling_20 %>% \n  st_as_sf(coords = c(\"lon\", \"lat\"))\n\n\n\n10 samples20 samplesDIRESA proposal\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nReading layer `red_vial' from data source \n  `C:\\Users\\anton\\Documents\\webpages-quarto\\webpage\\data\\first_sampling\\first_sampling.gpkg' \n  using driver `GPKG'\nSimple feature collection with 56 features and 16 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: -73.77742 ymin: -4.567471 xmax: -73.23745 ymax: -3.706127\nGeodetic CRS:  WGS 84\n\n\nReading layer `zungarococha' from data source \n  `C:\\Users\\anton\\Documents\\webpages-quarto\\webpage\\data\\first_sampling\\first_sampling.gpkg' \n  using driver `GPKG'\nSimple feature collection with 3 features and 8 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -73.40966 ymin: -3.858072 xmax: -73.35497 ymax: -3.828583\nGeodetic CRS:  WGS 84\n\n\nReading layer `iquitos_nauta' from data source \n  `C:\\Users\\anton\\Documents\\webpages-quarto\\webpage\\data\\first_sampling\\first_sampling.gpkg' \n  using driver `GPKG'\nSimple feature collection with 8 features and 8 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -73.56942 ymin: -4.501522 xmax: -73.32618 ymax: -3.822999\nGeodetic CRS:  WGS 84"
  }
]