<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Innovalab - Stratification and samplingÔ∏è of population centers in Loreto, Peru üé≤‚ú®</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./img/harmonize.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.26/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="site_libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>


<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/methodology.css">
<meta property="og:title" content="Innovalab - Stratification and samplingÔ∏è of population centers in Loreto, Peru üé≤‚ú®">
<meta property="og:description" content="Harmonize is a collaboration project with Colombia, Brazil, Dominican Republic and Peru, led by the Barcelona Supercomputing Center and funded by Wellcome Trust, that aims to develop a digital‚Ä¶">
<meta property="og:image" content="https://raw.githubusercontent.com/healthinnovation/Harmonize-Project/main/img/twitter-card.png">
<meta property="og:site-name" content="Innovalab">
<meta name="twitter:title" content="Innovalab - Stratification and samplingÔ∏è of population centers in Loreto, Peru üé≤‚ú®">
<meta name="twitter:description" content="This document describes the methodology carried out for the stratification and selection of population centers in Loreto for drone surveillance.">
<meta name="twitter:image" content="https://raw.githubusercontent.com/healthinnovation/Harmonize-Project/main/img/twitter-card.png">
<meta name="twitter:creator" content="@antony_barja">
<meta name="twitter:site" content="@antony_barja">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="https://raw.githubusercontent.com/healthinnovation/Harmonize-Project/main/img/harmonize.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Innovalab</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./webmap.html">
 <span class="menu-text">Webmap</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./methodology.html" aria-current="page">
 <span class="menu-text">Methodology</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://healthinnovation.github.io/harmonize-dashboard/">
 <span class="menu-text">Data audit</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./gantt_fieldwork.html">
 <span class="menu-text">Fieldwork Gantt</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/healthinnovation/harmonize"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/innovalab_imt"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro"><span class="toc-section-number">1</span>  Introduction</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset"><span class="toc-section-number">2</span>  Dataset</a></li>
  <li><a href="#stratification" id="toc-stratification" class="nav-link" data-scroll-target="#stratification"><span class="toc-section-number">3</span>  Stratification</a>
  <ul class="collapse">
  <li><a href="#agglomerative-hierarchical-clustering-analysis" id="toc-agglomerative-hierarchical-clustering-analysis" class="nav-link" data-scroll-target="#agglomerative-hierarchical-clustering-analysis"><span class="toc-section-number">3.1</span>  Agglomerative hierarchical clustering analysis</a></li>
  <li><a href="#determining-the-number-of-clusters" id="toc-determining-the-number-of-clusters" class="nav-link" data-scroll-target="#determining-the-number-of-clusters"><span class="toc-section-number">3.2</span>  Determining the number of clusters</a></li>
  <li><a href="#principal-components-analysis" id="toc-principal-components-analysis" class="nav-link" data-scroll-target="#principal-components-analysis"><span class="toc-section-number">3.3</span>  Principal components analysis</a></li>
  <li><a href="#comparing-hc-and-pca" id="toc-comparing-hc-and-pca" class="nav-link" data-scroll-target="#comparing-hc-and-pca"><span class="toc-section-number">3.4</span>  Comparing HC and PCA</a></li>
  </ul></li>
  <li><a href="#selection-of-populated-centers" id="toc-selection-of-populated-centers" class="nav-link" data-scroll-target="#selection-of-populated-centers"><span class="toc-section-number">4</span>  Selection of populated centers</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><br><br>Stratification and samplingÔ∏è of population centers in Loreto, Peru üé≤‚ú®</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="intro" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="intro"><span class="header-section-number">1</span> Introduction</h2>
<p>This document describes the methodology carried out for the stratification and selection of population centers in Loreto for drone surveillance. This activity is part of the the <em>Harmonize project: Harmonisation of spatio-temporal multi-scale data for health in climate change hotspots in the Peruvian Amazon</em> (SIDISI 209821), in collaboration with the Barcelona Supercomputing Center.</p>
<p>The Harmonize project has the following objectives:</p>
<ol type="1">
<li><p>Geo-location of cases collected by passive surveillance from the Peruvian Ministry of Health (MINSA) through the Center for Disease Control and Prevention (CDC-Peru) in the study area using GPS devices.</p></li>
<li><p>Identify potential mosquito breeding sites based on new longitudinal ground survey data and using drone surveillance.</p></li>
<li><p>Collect data from weather stations, satellite imagery, ambient acoustic sounds and air pollution to calibrate and reduce the spatial resolution of Earth observation data sets.</p></li>
<li><p>Determine the impact of the use of these new technologies on infectious disease reduction interventions carried out by the Direcci√≥n Regional de Salud (DIRESA) of Loreto.</p></li>
</ol>
<p>The methodology described here corresponds to the second objective above. Since we cannot map the whole study area of Loreto, our approach was to characterize the population centers in Loreto according to the incidence of relevant diseases in the area (Malaria, Dengue and Leptospirosis) and meteorological, environmental and human intervention variables and then use this variables to create sampling strata using clustering techniques. Finally, we randomly sampled a number of the population centers from each stratum proportional to the stratum size.</p>
</section>
<section id="dataset" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="dataset"><span class="header-section-number">2</span> Dataset</h2>
<p>For each population center, we gathered records on the following fields:</p>
<ul>
<li>UBIGEOCP, which is the official identification code of the population centers used by the Instituto Nacional de Estad√≠stica e Inform√°tica (INEI).</li>
<li>Official name.</li>
<li>Latitude and longitude.</li>
<li>2022 cumulative incidence of Malaria, Dengue and Leptospirosis.</li>
<li>Difference in the cumulative incidence of Malaria between 2010 and 2019.</li>
<li>Mean and difference of the annual mean values of the years 2010 and 2021 of the following variables:
<ul>
<li>Precipitation accumulation (mm),</li>
<li>Runoff (mm),</li>
<li>Soil moisture (mm),</li>
<li>Maximum temperature (¬∞C),</li>
<li>Minimum temperature (¬∞C),</li>
<li>Total evapotranspiration (kg/m<sup>2</sup>),</li>
<li>Specific humidity (kg/kg),</li>
<li>Deforestation area (km<sup>2</sup>).</li>
</ul></li>
<li>Mean and difference of the annual values of the years 2010 and 2020 of the following variables:
<ul>
<li>Population density from WorldPop and</li>
<li>Human settlement data from the Global Human Settlement Layer (GHSL).</li>
</ul></li>
<li>Mean and difference of the annual mean values from years 2014 and 2021 of the nighttime data from the Visible Infrared Imaging Radiometer Suite (VIIRS).</li>
</ul>
<p>We can take a look at the data in the following table:</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read dataset</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>processed_path <span class="ot">=</span> <span class="st">"data/processed/"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">=</span> <span class="st">"ccpp-10km.csv"</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">=</span> fs<span class="sc">::</span><span class="fu">path</span>(processed_path, file_name)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>ccpp <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(file_path, <span class="at">col_types =</span> <span class="st">"ccccccddcd"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display dataset</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>ccpp <span class="sc">%&gt;%</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">list</span>(<span class="at">display =</span> <span class="st">"compact"</span>, <span class="at">pageLength =</span> <span class="dv">5</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-33019f42e77c6e5e83cd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-33019f42e77c6e5e83cd">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60"],["160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160113","160301","160301","160301","160301","160301","160112","160112","160113","160113","160113","160113","160113","160113","160113"],["PE√ëA NEGRA","PUERTO ALMENDRAS","UNION PROGRESO","NINA RUMI","NUEVA ESPERANZA","MORALILLO","BUENA ESPERANZA","SANTA BARBARA","SAN CARLOS","EL DORADO","NUEVO MILAGRO","VILLA EL BUEN PASTOR","SAN JOSE","3 DE OCTUBRE","BELEN DE JUDA","13 DE FEBRERO","5 DE JUNIO","PAUJIL II ZONA","24 DE JUNIO","NUEVO HORIZONTE","EX PETROLEROS II ZONA","EX PETROLERO I ZONA","SAN PEDRO PINTUYACU","SAN LUCAS","UNION","10 DE OCTUBRE I ZONA","CAHUIDE","EL TRIUNFO","12 DE ABRIL","HABANA","NUEVO MIRAFLORES","12 DE OCTUBRE","ANGEL CARDENAS","CREACION 2000","NUEVO TRIUNFO","HUAMBE","10 DE OCTUBRE II ZONA","LOS CEDROS","HUASCAR","NUEVO SAN JUAN","SANTA CATALINA","23 DE FEBRERO","SAN MARTIN II ZONA","SHUSHUNA","LOS DELFINES","CALIPSO","TUPAC AMARU II","SANTA CRUZ","1 DE FEBRERO","PUERTO PRADO","NAUTA","SAN JUAN DE MUNICH","5 DE DICIEMBRE","VILLA CRUZ","SAN CIRILO","LLANCHAMA","EL VARILLAL","EL PAUJIL","ZUNGAROCOCHA","QUISTOCOCHA"],["LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO","LORETO"],["MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","LORETO","LORETO","LORETO","LORETO","LORETO","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS","MAYNAS"],["SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","NAUTA","NAUTA","NAUTA","NAUTA","NAUTA","BELEN","BELEN","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA","SAN JUAN BAUTISTA"],["1601130022","1601130004","1601130070","1601130005","1601130027","1601130025","1601130063","1601130064","1601130065","1601130028","1601130034","1601130036","1601130026","1601130012","1601130013","1601130031","1601130020","1601130030","1601130029","1601130033","1601130039","1601130037","1601130040","1601130045","1601130043","1601130044","1601130056","1601130046","1601130055","1601130049","1601130054","1601130057","1601130074","1601130077","1601130078","1601130079","1601130082","1601130083","1601130084","1601130086","1601130088","1601130089","1601130090","1601130097","1601130069","1601130093","1603010041","1603010024","1603010099","1603010101","1603010001","1601120049","1601120076","1601130098","1601130099","1601130006","1601130024","1601130032","1601130018","1601130017"],[-73.34,-73.38,-73.34,-73.39,-73.41,-73.34,-73.32,-73.33,-73.35,-73.41,-73.37,-73.36,-73.39,-73.36,-73.38,-73.43,-73.39,-73.47,-73.42,-73.45,-73.47,-73.45,-73.4,-73.45,-73.42,-73.45,-73.49,-73.47,-73.48,-73.48,-73.47,-73.55,-73.43,-73.4,-73.5,-73.49,-73.46,-73.45,-73.55,-73.53,-73.48,-73.46,-73.44,-73.34,-73.34,-73.35,-73.61,-73.55,-73.55,-73.54,-73.57,-73.32,-73.32,-73.37,-73.46,-73.41,-73.35,-73.44,-73.35,-73.33],[-3.86,-3.83,-3.86,-3.84,-3.91,-3.92,-3.9,-3.94,-3.96,-3.95,-3.94,-3.95,-3.93,-3.97,-3.98,-4.01,-4,-4,-4.02,-4.07,-4.06,-4.09,-4.1,-4.1,-4.13,-4.12,-4.23,-4.15,-4.22,-4.2,-4.22,-4.25,-4.05,-4.08,-4.13,-4.16,-4.15,-4.22,-4.26,-4.33,-4.12,-4.15,-4.18,-3.83,-3.84,-3.87,-4.54,-4.48,-4.36,-4.47,-4.5,-3.94,-3.88,-3.85,-4.06,-3.86,-3.89,-4.04,-3.83,-3.82],["INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","INNOVALAB","DIRESA","DIRESA","DIRESA","DIRESA","DIRESA"],[736,201,216,672,36,201,17,40,86,90,163,65,123,35,23,670,31,51,16,308,9,796,21,186,16,43,794,112,244,112,89,61,50,12,16,59,86,13,10,104,20,17,31,98,4366,1155,10,170,183,64,19551,147,25,178,242,267,743,145,813,2172],[0.02,0,0,0,0,0,0,0,0,0,0,0.02,0.02,0,0,0,0,0,0,0,0,0,0,0,0,0,0.02,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.01,0,0,0,0,0,0,0.01,0.05,0,0,0,0,0.02,0.01,0.01,0.01],[0.01,0.14,0,0.11,0.03,0.04,0,0.03,0,0.01,0.06,0.78,0.02,0,0,0,0,0,0,0.03,0,0.02,0,0.04,0,0,0,0.02,0,0,0,0,0.02,0,0.19,0,0,0.31,0,0,0.05,0,0,0,0,0.01,0,0,0,0,0.01,0.05,0.04,0,0,0.28,0.21,0.13,0.02,0.01],[0.01,0,0,0,0,0,0,0.05,0.01,0,0,0,0.01,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.15,0,0,0,0,0,0,0.01,0,0,0,0,0,0.01,0.17,0,0.01,0,0,0.01,0,0,0.01],[2357.27,2357.78,2358.31,2357.28,2354.19,2347.63,2346.98,2340.09,2338.9,2347.71,2349.25,2344.83,2351.33,2339.67,2338.58,2329.99,2331.05,2331.51,2327.43,2308.23,2307.92,2298.33,2291.65,2294.3,2283.43,2286.19,2241.5,2273.94,2246.38,2253.55,2246.19,2226.74,2317.01,2299.66,2281.76,2269.98,2275.15,2246.74,2223.19,2209.38,2284.65,2276.49,2264.97,2362.16,2360.11,2356.88,2155.39,2168.97,2199.42,2172.07,2162.35,2340.77,2349.5,2358.45,2314.56,2355.49,2355.06,2320.17,2360.4,2361.71],[1375.45,1376.07,1376.3,1375.71,1376.92,1366.98,1367.28,1360.23,1359.1,1370.08,1369.49,1364.9,1372.78,1359.84,1358.95,1348.19,1349.94,1350.99,1345.1,1327.27,1327.83,1317.76,1311,1313.65,1303.48,1305.5,1260.27,1293.58,1265.75,1273.4,1265.67,1245.48,1334.69,1319.21,1301.08,1289.61,1294.95,1266.57,1241.58,1225.59,1303.92,1296.24,1286.11,1380.01,1377.94,1374.75,1161.82,1177.63,1214.8,1181.27,1170.04,1361.19,1370.16,1376.09,1333.28,1375.73,1373.22,1337.75,1378.27,1380.28],[453.76,446.34,452.54,448.19,456.42,462.09,460.7,467.01,468.28,463.38,463.1,465.45,461.1,468.12,468.43,469.45,471.35,465.86,470.97,474.13,471.7,475.85,480.26,476.73,481.72,479.14,485.1,480.59,484.63,483.86,485.29,488.37,473.49,478.78,477.21,480.8,480.97,485.91,488.69,492.42,477.17,480.85,484.41,448,450.35,454.99,527.33,501.11,496.66,498.53,509.39,466.19,458.06,450.14,471.95,449.34,457.05,471.98,446.72,447.32],[377.41,378.56,377.57,378.37,377.54,376.83,376.9,377,377.11,377.25,377,377.05,377.13,377.23,377.51,377.93,377.9,377.79,378.08,378.8,378.67,379.11,379.09,379.21,379.3,379.39,380.85,379.78,380.72,380.53,380.57,381.29,378.52,378.89,379.45,379.89,379.74,380.32,381.35,381.29,379.42,379.7,379.79,378.11,377.84,377.29,383.71,383.35,381.35,383.13,383.66,376.97,376.97,378.07,378.55,378.33,377.12,378.38,378.38,378.14],[262.37,262.46,262.37,262.4,261.9,262.56,262.78,263.14,263.08,262.13,262.24,262.6,262.04,262.94,262.9,262.76,263.28,262.1,263.06,263.59,263.07,263.77,264.33,263.82,264.29,264,264.66,263.92,264.62,264.54,264.63,264.57,263.52,264.27,263.36,263.79,264.08,264.5,264.63,264.27,263.54,264.1,264.27,262.36,262.37,262.28,265.16,265.35,263.96,265.23,265.43,263.2,262.66,262.31,263.22,262.34,262.25,263.24,262.4,262.3],[31.36,30.87,31.2,31.18,31.63,32.82,32.93,32.96,32.8,31.97,32.24,32.51,31.89,32.67,32.76,32.75,33.25,32.06,33,32.81,32.64,32.96,33.79,32.98,33.76,33.19,33.42,32.88,33.28,33.06,33.35,32.93,33.2,33.79,32.74,32.92,32.97,33.28,33.19,32.49,32.84,33.03,33.13,30.39,30.79,31.48,33.17,33.26,31.84,33.12,33.24,33.04,32.29,30.78,32.65,31.59,31.78,32.81,30.25,30.32],[0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22],[2.13,0.93,2.15,0.72,0.27,0.96,1.17,0.54,0.51,0.42,0.58,0.62,0.49,0.53,0.47,0.41,0.43,0.28,0.43,0.38,0.34,0.35,0.26,0.36,0.24,0.31,0.32,0.26,0.31,0.3,0.31,0.2,0.44,0.29,0.23,0.26,0.27,0.3,0.21,0.3,0.27,0.27,0.22,2.15,2.13,1.86,0.54,0.54,0.28,0.21,0.95,0.54,1.73,1.49,0.39,0.55,1.52,0.46,1.67,2.46],[0.78,0.83,0.86,0.8,0.37,0.69,0.59,0.46,0.63,0.56,0.76,0.71,0.63,0.72,0.78,0.62,0.75,0.44,0.65,0.72,0.64,0.8,0.52,0.8,0.53,0.83,0.63,0.77,0.63,0.61,0.57,0.4,0.75,0.39,0.81,0.8,0.81,0.51,0.44,0.46,0.85,0.81,0.49,0.96,0.96,0.99,0.41,0.27,0.37,0.21,0.55,0.53,0.53,1.02,0.65,0.47,1,0.74,1,0.9],[7202.86,4990.4,7938.05,3207.02,410.68,1506.87,1414.08,436.35,589.53,1218.66,1244.22,1225.54,1160.36,891.9,1111.57,693.93,695.29,352.03,736.57,902.67,822.36,816.41,105.77,803.01,125.13,619.38,264.09,129.78,269.05,281.5,262.81,17.54,721.1,139.41,105.79,106.33,117.48,261.77,75.74,110.33,453.5,174.18,92.14,14978.77,9396.36,5524.46,2256.24,3400.18,74.86,373.28,5376.79,242.31,3437.8,5718.75,862.75,659.58,3159.23,709.38,10800.65,19442.15],[1.9,1.4,2.09,1.09,0.58,0.73,0.9,0.54,0.54,0.66,0.69,0.67,0.67,0.62,0.62,0.51,0.48,0.5,0.5,0.61,0.62,0.61,0.56,0.6,0.57,0.59,0.41,0.51,0.41,0.43,0.41,0.43,0.55,0.54,0.53,0.49,0.52,0.42,0.42,0.37,0.56,0.53,0.5,2.96,2.37,1.52,0.72,0.97,0.36,0.52,1.3,0.54,1.32,1.57,0.59,0.61,1.12,0.54,2.46,4.08],[1840,5326.5,0,39312,18,402,0,0,301,135,81.5,32.5,184.5,0,0,9715,0,0,0,0,4.5,2786,10.5,1302,672,0,11910,112,0,0,0,30.5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,85,91.5,0,3665812.5,1543.5,0,0,0,22962,27119.5,145,103251,156384],[1292.5,1295.56,1292.8,1297.58,1302.29,1292.88,1289.15,1290.84,1292.04,1299.15,1297.7,1295.36,1299.57,1292.85,1292.46,1285.37,1286.88,1288.27,1281.95,1258.94,1260.71,1247.82,1239.27,1243.17,1228.19,1233.02,1182.41,1218.87,1187.43,1195.03,1186.3,1167.54,1269.04,1249.51,1229.37,1214.14,1219.89,1185.98,1164.65,1151.64,1232.79,1221.37,1206.03,1292.05,1292.76,1294.87,1049.75,1106.33,1138.05,1112.69,1087.52,1289.68,1288.02,1297.47,1266.93,1300.88,1295.67,1273.15,1293.66,1289.97],[1196.58,1199.07,1196.61,1200.57,1205.44,1199.19,1194.59,1197.04,1198.57,1205.34,1203.97,1202.01,1205.05,1199.9,1199.55,1191.52,1194.17,1193.55,1188.69,1166.9,1168,1155.82,1147.36,1151.12,1136.62,1141.04,1096.65,1127.53,1100.64,1106.79,1099.68,1082.79,1176.92,1157.9,1136.86,1123.46,1128.4,1099.17,1080.6,1070.82,1140.37,1129.84,1116.22,1194.89,1196.12,1199.08,974.62,1029.7,1059.55,1036.18,1010.99,1195.8,1192.8,1200.77,1174.28,1202.83,1200.29,1180.5,1196.94,1192.74],[66.71,65.14,66.68,64.86,63.81,66.11,66.71,65.83,65.34,64.13,65.12,65.3,64.59,65.21,64.94,63.37,64.85,61.95,63.8,62.21,60.97,61.57,62.09,61.4,61.5,61.28,53.67,60.31,54.99,56.77,54.62,51.54,63.44,62.85,59.72,59.57,60.7,54.44,50.17,44.27,60.21,60.81,59.14,66.73,66.68,66.38,38.04,28.58,42.05,27.7,31.47,66.24,66.94,65.51,62.07,63.76,66.14,63.05,65.99,66.78],[-0.39,-0.28,-0.39,-0.26,-0.3,-0.54,-0.5,-0.73,-0.78,-0.49,-0.59,-0.68,-0.47,-0.74,-0.66,-0.5,-0.63,-0.39,-0.53,-0.6,-0.54,-0.62,-0.67,-0.61,-0.57,-0.58,-0.66,-0.54,-0.65,-0.63,-0.67,-0.63,-0.59,-0.71,-0.54,-0.52,-0.55,-0.67,-0.65,-0.58,-0.55,-0.55,-0.52,-0.36,-0.38,-0.38,-0.42,-0.53,-0.65,-0.55,-0.47,-0.68,-0.45,-0.3,-0.55,-0.22,-0.4,-0.56,-0.33,-0.35],[-0.39,-0.28,-0.39,-0.26,-0.3,-0.54,-0.5,-0.73,-0.78,-0.49,-0.59,-0.68,-0.47,-0.74,-0.66,-0.5,-0.63,-0.39,-0.53,-0.6,-0.54,-0.62,-0.67,-0.61,-0.57,-0.58,-0.66,-0.54,-0.65,-0.63,-0.67,-0.63,-0.59,-0.71,-0.54,-0.52,-0.55,-0.67,-0.65,-0.58,-0.55,-0.55,-0.52,-0.36,-0.38,-0.38,-0.39,-0.53,-0.65,-0.55,-0.45,-0.68,-0.45,-0.3,-0.55,-0.22,-0.4,-0.56,-0.33,-0.35],[-0.65,0.04,-0.7,0.29,0.48,-0.63,-0.59,-0.86,-0.63,0.14,-0.26,-0.33,0.12,-0.25,0.14,-0.03,0.64,-0.8,0.21,-0.51,-0.79,-0.72,-0.18,-0.8,-0.46,-0.46,-1.48,-1.06,-1.43,-1.35,-1.72,-1.26,-0.3,0.49,-1.35,-0.85,-0.97,-2.14,-1.07,-0.2,-1.09,-0.94,-1.68,-1.25,-0.89,-0.61,-3.26,-2.96,-0.53,-2.62,-3.25,-1.03,-0.68,0.11,-0.68,0.71,-0.36,-0.51,-0.6,-1.44],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1.24,0.51,1.27,0.19,0.06,0.37,0.44,0.07,0.09,0.23,0.21,0.23,0.18,0.18,0.2,0.19,0.16,0.12,0.19,0.18,0.17,0.15,0.03,0.16,0.04,0.1,0.09,0.06,0.09,0.09,0.09,-0.02,0.2,0.01,0.04,0.06,0.06,0.09,-0.01,0.01,0.08,0.06,0.03,0.94,1.23,1.05,-0.08,0.23,0.02,-0,0.13,0.06,0.95,0.85,0.19,0.08,0.75,0.23,0.98,0.89],[0.14,-0.37,-0.02,0.07,0.52,0.57,0.28,0.32,0.15,-0.04,0.33,0.17,0.34,0.01,-0.11,-0.32,0.13,-0.42,-0.21,-0.33,-0.62,-0.37,-0.22,-0.4,-0.07,-0.21,-0.01,0.03,-0.18,-0.08,-0.14,0.03,-0.46,-0.04,0.07,-0.14,-0.04,-0.21,0.03,-0.5,-0.15,-0.24,0.04,-0.26,-0.31,0.53,0.49,0.47,-0.15,0.38,0.84,0.39,0.06,0.06,-0.52,0.25,0.64,-0.46,-0.62,-0.09],[1861.18,1193.64,2024.89,909.45,288.61,747.24,618.6,396.4,422.82,896.11,1036.16,953.37,926.58,743.31,994.5,365.52,595.9,191,376.67,350.48,301.47,398.86,83.08,398.32,114.76,319.37,51.4,108.12,52.59,50.41,56.05,11.39,322.58,114.4,108.87,57.83,96.58,59.56,49.46,25.42,245.01,117.33,70.53,3245.57,2560.91,1674,406.52,288.64,20.68,119.2,681.99,232.96,1009.51,1549.33,341.66,219,1098.88,370.13,2494.64,3240.75],[0.98,0.45,1.03,0.46,0.38,0.5,0.7,0.39,0.41,0.34,0.36,0.33,0.37,0.32,0.32,0.35,0.35,0.35,0.35,0.47,0.51,0.48,0.45,0.48,0.44,0.5,0.23,0.46,0.23,0.26,0.24,0.24,0.41,0.45,0.47,0.42,0.49,0.27,0.21,0.17,0.49,0.5,0.44,1.36,1.08,0.9,0.26,0.39,0.17,0.34,0.46,0.38,0.98,0.73,0.46,0.43,0.8,0.37,1.08,1.35],[0,0.08,0,0.09,-0.03,0,0,0,0.01,-0.01,-0.01,-0.02,0.01,0,0,-0.04,0,0,0,0,-0.11,-0,-0.05,-0.06,-4.25,0,0.02,-0.02,0,0,0,-0.02,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.2,-0.01,-0.01,0,-0,-0.09,0,0,0,0.15,0.07,-0.01,0.02,-0.01]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>ubigeo<\/th>\n      <th>nomcp<\/th>\n      <th>dep<\/th>\n      <th>prov<\/th>\n      <th>dist<\/th>\n      <th>ubigeocp<\/th>\n      <th>lng<\/th>\n      <th>lat<\/th>\n      <th>group<\/th>\n      <th>poblacion<\/th>\n      <th>dengue<\/th>\n      <th>malaria<\/th>\n      <th>leptospirosis<\/th>\n      <th>pr_avg<\/th>\n      <th>ro_avg<\/th>\n      <th>soil_avg<\/th>\n      <th>tmmx_avg<\/th>\n      <th>tmmn_avg<\/th>\n      <th>etp_avg<\/th>\n      <th>humidity_avg<\/th>\n      <th>pop_avg<\/th>\n      <th>def_avg<\/th>\n      <th>ghsl_avg<\/th>\n      <th>ln_avg<\/th>\n      <th>malaria_avg<\/th>\n      <th>pr_diff<\/th>\n      <th>ro_diff<\/th>\n      <th>soil_diff<\/th>\n      <th>tmmx_diff<\/th>\n      <th>tmmn_diff<\/th>\n      <th>etp_diff<\/th>\n      <th>humidity_diff<\/th>\n      <th>pop_diff<\/th>\n      <th>def_diff<\/th>\n      <th>ghsl_diff<\/th>\n      <th>ln_diff<\/th>\n      <th>malaria_diff<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"display":"compact","pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="stratification" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="stratification"><span class="header-section-number">3</span> Stratification</h2>
<p>The stratification of the population centers consisted of using the meteorological, environmental and human intervention variables to built groups of population centers with homogeneous characteristics. For this purpose, we tested two approaches. The first one consisted of performing an Agglomerative (‚Äúbottom-up‚Äù) Hierarchical Clustering (AHC) analysis using different distances, linkage methods, and number of clusters selection methods. On the second one, we used Principal Component Analysis (PCA) to reduce the dimension of the variables to one principal dimension and used it‚Äôs scores to create groups by quantile classification.</p>
<section id="agglomerative-hierarchical-clustering-analysis" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="agglomerative-hierarchical-clustering-analysis"><span class="header-section-number">3.1</span> Agglomerative hierarchical clustering analysis</h3>
<p>The AHC analysis consisted of two steps. First, we run several configurations the agglomerative nesting algorithms and selected the one which gave us the best hierarchical clustering (HC) structure. Secondly, from the selected hierarchical clustering structure, we calculated and examined a number of indices for determining the most appropriate number of clusters.</p>
<section id="chosing-the-hierarchical-clustering-structure" class="level4" data-number="3.1.1">
<h4 data-number="3.1.1" class="anchored" data-anchor-id="chosing-the-hierarchical-clustering-structure"><span class="header-section-number">3.1.1</span> Chosing the hierarchical clustering structure</h4>
<p>For this first step, we tested combinations of the following methods:</p>
<ul>
<li>Scaling method: Whether to use normalization (scaling from 0 to 1) or standardadization (subtracting the mean and dividing by the standard deviation).</li>
<li>Distance: Whether to use euclidean distance or correlation-based distances, such as Pearson or Spearman correlation.</li>
<li>Linkage method: Whether to use average, single, complete, Ward or weighted average linkage method.</li>
</ul>
<p>For each combination, we run the agglomerative nesting algorithm and calculated the <em>agglomerative coefficient</em> (AC) which is a measure of the strength of the HC structure <span class="citation" data-cites="boehmke2019hands">(<a href="#ref-boehmke2019hands" role="doc-biblioref">Boehmke and Greenwell 2019, 421‚Äì22</a>)</span>. For the 3 combinations of methods with larger AC, we also examined the resulting dendograms.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select variables for analysis</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>variables <span class="ot">=</span> <span class="fu">select</span>(ccpp, dengue<span class="sc">:</span>malaria_diff)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to scale data either by standardization or normalization</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>scale_data <span class="ot">=</span> <span class="cf">function</span>(data, method) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (method <span class="sc">==</span> <span class="st">"standardization"</span>) {</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    data_scaled <span class="ot">=</span> <span class="fu">mutate</span>(data, <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">as.numeric</span>(<span class="fu">scale</span>(.x))))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (method <span class="sc">==</span> <span class="st">"normalization"</span>) {</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    data_scaled <span class="ot">=</span> <span class="fu">mutate</span>(data, <span class="fu">across</span>(<span class="fu">everything</span>(), scales<span class="sc">::</span>rescale))</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  data_scaled</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Listing the configurations for the scaling, distance and linkage methods</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>scaling_method <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"standardization"</span>, <span class="st">"normalization"</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>dist_method <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"euclidean"</span>, <span class="st">"pearson"</span>, <span class="st">"spearman"</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>linkage_method <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"average"</span>, <span class="st">"single"</span>, <span class="st">"complete"</span>, <span class="st">"ward"</span>, <span class="st">"weighted"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Table with all the combinations</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>design <span class="ot">=</span> tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(scaling_method, dist_method, linkage_method, variables)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the agglomerative coefficient for each combination</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>agglomerative_coeff <span class="ot">=</span> design <span class="sc">%&gt;%</span> </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">nest</span>(<span class="at">data =</span> <span class="sc">-</span><span class="fu">c</span>(scaling_method, dist_method, linkage_method)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">scaling =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(data, scaling_method, <span class="sc">~</span><span class="fu">scale_data</span>(.x, <span class="at">method =</span> .y)),</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist_mat =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(scaling, dist_method, <span class="sc">~</span><span class="fu">get_dist</span>(.x, <span class="at">method =</span> .y)),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">tree =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(dist_mat, linkage_method, <span class="sc">~</span><span class="fu">agnes</span>(.x, <span class="at">method =</span> .y)),</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">ac =</span> purrr<span class="sc">::</span><span class="fu">map</span>(tree, <span class="sc">~</span>.x<span class="sc">$</span>ac)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(ac) <span class="sc">%&gt;%</span> </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>ac)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The best 3 HC structures according to the AC were the following:</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the best 3 structures </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>agglomerative_coeff <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(data, scaling, dist_mat, tree)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), stringr<span class="sc">::</span>str_to_title)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(.x, <span class="dv">4</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"Scaling"</span>, <span class="st">"Distance"</span>, <span class="st">"Linkage"</span>, <span class="st">"AC"</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-fe19cd470c22a8232c30" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fe19cd470c22a8232c30">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["Normalization","Standardization","Standardization"],["Pearson","Spearman","Pearson"],["Ward","Ward","Ward"],[0.983,0.9828,0.9737]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Scaling<\/th>\n      <th>Distance<\/th>\n      <th>Linkage<\/th>\n      <th>AC<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-right","targets":4},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<p>The difference of the first 3 AC values are almost negligible. Consequently, we examined the dendograms:</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot a dendogram</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dendogram <span class="ot">=</span> <span class="cf">function</span>(row, title) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  dendogram <span class="ot">&lt;-</span> <span class="fu">fviz_dend</span>(agglomerative_coeff<span class="sc">$</span>tree[[row]], <span class="at">main =</span> title) <span class="sc">+</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  dendogram</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">HC structure 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">HC structure 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">HC structure 3</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dendogram</span>(<span class="dv">1</span>, <span class="st">"Normalization, Pearson correlation, Ward linkage"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dendogram</span>(<span class="dv">2</span>, <span class="st">"Standardization, Spearman correlation, Ward linkage"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dendogram</span>(<span class="dv">3</span>, <span class="st">"Standardization, Pearson correlation, Ward linkage"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<p>After inspecting the dendograms, we chose the second HC structure as it seems to yield more homogeneous groups with relatively similar sizes for the different height values.</p>
</section>
</section>
<section id="determining-the-number-of-clusters" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="determining-the-number-of-clusters"><span class="header-section-number">3.2</span> Determining the number of clusters</h3>
<p>We calculated and plotted the Average silhouette width, Total within sum of squares and Gap statistic for a range of 1 to 10 number of clusters and examined the optimal number of cluster for each criteria. We defined a range of numbers of clusters that met or near met the optimal criteria and then for each one of them we used PCA to visualize the clusters in 2 dimensions to evaluate how well the groups were formed. In addition, the silhouette information of each observation was plotted to assess if there were observations that might have been misclustered.</p>
<section id="evaluation-of-the-criteria-of-the-optimal-number-of-clusters" class="level4" data-number="3.2.1">
<h4 data-number="3.2.1" class="anchored" data-anchor-id="evaluation-of-the-criteria-of-the-optimal-number-of-clusters"><span class="header-section-number">3.2.1</span> Evaluation of the criteria of the optimal number of clusters</h4>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot optimal number of clusters plot for a certain criteria</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>nbclust_plot <span class="ot">=</span> <span class="cf">function</span>(data, method, ...) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  nbclust <span class="ot">&lt;-</span> <span class="fu">fviz_nbclust</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    data, hcut, <span class="at">hc_func =</span> <span class="st">"agnes"</span>, <span class="at">hc_method =</span> <span class="st">"ward.D2"</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">c_metric =</span> <span class="st">"spearman"</span>, <span class="at">method =</span> method, ...</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  nbclust</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale variables using standardization</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>variables_std <span class="ot">=</span> <span class="fu">mutate</span>(variables, <span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">as.numeric</span>(<span class="fu">scale</span>(.x))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Average silhouette width</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Total within sum of squares</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Gap statistic</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nbclust_plot</span>(variables_std, <span class="st">"silhouette"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nbclust_plot</span>(variables_std, <span class="st">"wss"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nbclust_plot</span>(variables_std, <span class="st">"gap_stat"</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<p>According to the average silhouette width, the optimal number of clusters is 5. In the total within sum of squares plot, we see an apparent elbow at 4 clusters. Finally, the Gap statistic tells us that the optimal number of clusters is 10 or more. However, we do not wanted to work with more than 5 clusters, 4 or 5 clusters would be the closest optimal.</p>
</section>
<section id="clusters-plots" class="level4" data-number="3.2.2">
<h4 data-number="3.2.2" class="anchored" data-anchor-id="clusters-plots"><span class="header-section-number">3.2.2</span> Clusters plots</h4>
<p>Next, we plotted the clusters in a plane using PCA for 4 and 5 clusters.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to cut tree</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>cut_tree <span class="ot">=</span> <span class="cf">function</span>(data, k) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  tree <span class="ot">=</span> <span class="fu">hcut</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    data, <span class="at">k =</span> k, <span class="at">hc_func =</span> <span class="st">"agnes"</span>, <span class="at">hc_method =</span> <span class="st">"ward.D2"</span>, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hc_metric =</span> <span class="st">"spearman"</span>, <span class="at">graph =</span> <span class="cn">TRUE</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  tree</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to generate cluster plot</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>cluster_plot <span class="ot">=</span> <span class="cf">function</span>(tree) {</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  cluster <span class="ot">=</span> <span class="fu">fviz_cluster</span>(tree, <span class="at">ggtheme =</span> <span class="fu">theme_classic</span>()) <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  cluster</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">4 clusters</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">5 clusters</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tree_4 <span class="ot">=</span> <span class="fu">cut_tree</span>(variables_std, <span class="dv">4</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cluster_plot</span>(tree_4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tree_5 <span class="ot">=</span> <span class="fu">cut_tree</span>(variables_std, <span class="dv">5</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cluster_plot</span>(tree_5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<p>We can see that the fifth group is formed from some populated centers of clusters 2 and 3 in the 4-cluster graph.</p>
</section>
<section id="individual-silhouette-widths" class="level4" data-number="3.2.3">
<h4 data-number="3.2.3" class="anchored" data-anchor-id="individual-silhouette-widths"><span class="header-section-number">3.2.3</span> Individual silhouette widths</h4>
<p>Next, we plotted the individual silhouette width for the observations grouped 4 and 5 clusters.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot individual silhouette widths</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>silhouette_plot <span class="ot">=</span> <span class="cf">function</span>(tree) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  ind_silhouette <span class="ot">&lt;-</span> tree <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fviz_silhouette</span>(<span class="at">ggtheme =</span> <span class="fu">theme_classic</span>(), <span class="at">print.summary =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  ind_silhouette</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">4 clusters</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">5 clusters</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">silhouette_plot</span>(tree_4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">silhouette_plot</span>(tree_5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<p>We see that with 5 clusters we obtain a greater average silhouette width (0.44) than with 4 clusters (0.41). However, with 5 clusters with get greater negative values for some populated centers, indicating that they may be misclustered.</p>
</section>
<section id="hc-groups-on-maps" class="level4" data-number="3.2.4">
<h4 data-number="3.2.4" class="anchored" data-anchor-id="hc-groups-on-maps"><span class="header-section-number">3.2.4</span> HC groups on maps</h4>
<p>As an additional step, for each number of clusters, we plotted the population centers (polygon centroids) on a map to see their spatial distribution.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create table with the groups</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ccpp_clusters <span class="ot">=</span> ccpp <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">hc_group_4 =</span> <span class="fu">as.factor</span>(tree_4<span class="sc">$</span>cluster),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hc_group_5 =</span> <span class="fu">as.factor</span>(tree_5<span class="sc">$</span>cluster)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot a map with the clusters</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>cluster_map <span class="ot">=</span> <span class="cf">function</span>(data, palette, group_var) {</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  values <span class="ot">=</span> <span class="fu">pull</span>(data, {{group_var}})</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  map <span class="ot">=</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addTiles</span>(<span class="at">group =</span> <span class="st">"OpenStreetMap"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addProviderTiles</span>(<span class="at">provider =</span> providers<span class="sc">$</span>CartoDB, <span class="at">group =</span> <span class="st">"CartoDB"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addProviderTiles</span>(</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">provider =</span> providers<span class="sc">$</span>Esri.WorldImagery, <span class="at">group =</span> <span class="st">"Satelital"</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addCircleMarkers</span>(</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">popup =</span> ccpp<span class="sc">$</span>population_center, <span class="at">color =</span> <span class="sc">~</span><span class="fu">palette</span>(values),</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">opacity =</span> <span class="dv">1</span>, <span class="at">radius =</span> <span class="fl">0.1</span>, <span class="at">fillOpacity =</span> <span class="fl">0.5</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">%&gt;%</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addLayersControl</span>(</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"CartoDB"</span>, <span class="st">"OpenStreetMap"</span>, <span class="st">"Satelital"</span>)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addLegend</span>(</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Cluster"</span>, <span class="at">pal =</span> palette, <span class="at">values =</span> values, <span class="at">opacity =</span> <span class="dv">1</span>,</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">position =</span> <span class="st">"bottomright"</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  map</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">

</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">4 clusters</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">5 clusters</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Palette for 4 clusters</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>palette_hc_4 <span class="ot">=</span> <span class="fu">colorFactor</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"viridis"</span>, <span class="at">domain =</span> ccpp_clusters<span class="sc">$</span>hc_group_4</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot cluster map</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cluster_map</span>(ccpp_clusters, palette_hc_4, hc_group_4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-982a8fa8276dd255bbda" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-982a8fa8276dd255bbda">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["CartoDB",null,"CartoDB",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelital",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[-3.863147,-3.831725,-3.856809,-3.84476,-3.906268,-3.915436,-3.898959,-3.944115,-3.95913,-3.954165,-3.938261,-3.94906,-3.931736,-3.966216,-3.978227,-4.01441,-4.003298,-4.00331,-4.02111,-4.071663,-4.064827,-4.094611,-4.103035,-4.103997,-4.127523,-4.123837,-4.230846,-4.154149,-4.219298,-4.203191,-4.223144,-4.246472,-4.05018,-4.082073,-4.126287,-4.162137,-4.15309,-4.2224,-4.260209,-4.330362,-4.121844,-4.14977,-4.179054,-3.830152,-3.844786,-3.874062,-4.542548,-4.480263,-4.356997,-4.471702,-4.501522,-3.93564,-3.881458,-3.853171,-4.056845,-3.857972,-3.88769,-4.0423,-3.828583,-3.822999],[-73.336776,-73.378019,-73.338717,-73.385881,-73.413631,-73.340366,-73.322513,-73.329072,-73.345052,-73.40642,-73.374641,-73.362468,-73.391568,-73.361572,-73.384126,-73.433988,-73.39309,-73.469968,-73.423672,-73.445628,-73.47498,-73.453248,-73.402808,-73.454582,-73.415961,-73.448246,-73.487435,-73.47431,-73.483968,-73.479276,-73.466734,-73.548449,-73.426447,-73.395123,-73.497835,-73.49033,-73.462008,-73.451622,-73.546,-73.531539,-73.483562,-73.458473,-73.437879,-73.335523,-73.3394,-73.347699,-73.60862,-73.54581,-73.55276,-73.538462,-73.569425,-73.32016,-73.318977,-73.373493,-73.455098,-73.409216,-73.351417,-73.437658,-73.354973,-73.326179],0.1,null,null,{"interactive":true,"className":"","stroke":true,"color":["#440154","#440154","#440154","#440154","#440154","#440154","#440154","#31688E","#31688E","#440154","#31688E","#31688E","#440154","#31688E","#31688E","#31688E","#31688E","#31688E","#31688E","#35B779","#31688E","#35B779","#35B779","#35B779","#35B779","#35B779","#FDE725","#35B779","#FDE725","#FDE725","#FDE725","#FDE725","#35B779","#35B779","#35B779","#35B779","#35B779","#FDE725","#FDE725","#FDE725","#35B779","#35B779","#FDE725","#440154","#440154","#440154","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#31688E","#440154","#440154","#31688E","#440154","#440154","#31688E","#440154","#440154"],"weight":5,"opacity":1,"fill":true,"fillColor":["#440154","#440154","#440154","#440154","#440154","#440154","#440154","#31688E","#31688E","#440154","#31688E","#31688E","#440154","#31688E","#31688E","#31688E","#31688E","#31688E","#31688E","#35B779","#31688E","#35B779","#35B779","#35B779","#35B779","#35B779","#FDE725","#35B779","#FDE725","#FDE725","#FDE725","#FDE725","#35B779","#35B779","#35B779","#35B779","#35B779","#FDE725","#FDE725","#FDE725","#35B779","#35B779","#FDE725","#440154","#440154","#440154","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#31688E","#440154","#440154","#31688E","#440154","#440154","#31688E","#440154","#440154"],"fillOpacity":0.5},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["CartoDB","OpenStreetMap","Satelital"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addLegend","args":[{"colors":["#440154","#31688E","#35B779","#FDE725"],"labels":["1","2","3","4"],"na_color":null,"na_label":"NA","opacity":1,"position":"bottomright","type":"factor","title":"Cluster","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[-4.542548,-3.822999],"lng":[-73.60862,-73.318977]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Palette for 5 clusters</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>palette_hc_5 <span class="ot">=</span> <span class="fu">colorFactor</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"viridis"</span>, <span class="at">domain =</span> ccpp_clusters<span class="sc">$</span>hc_group_5</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot cluster map</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cluster_map</span>(ccpp_clusters, palette_hc_5, hc_group_5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6440797dfa23c6ecca24" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6440797dfa23c6ecca24">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["CartoDB",null,"CartoDB",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelital",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[-3.863147,-3.831725,-3.856809,-3.84476,-3.906268,-3.915436,-3.898959,-3.944115,-3.95913,-3.954165,-3.938261,-3.94906,-3.931736,-3.966216,-3.978227,-4.01441,-4.003298,-4.00331,-4.02111,-4.071663,-4.064827,-4.094611,-4.103035,-4.103997,-4.127523,-4.123837,-4.230846,-4.154149,-4.219298,-4.203191,-4.223144,-4.246472,-4.05018,-4.082073,-4.126287,-4.162137,-4.15309,-4.2224,-4.260209,-4.330362,-4.121844,-4.14977,-4.179054,-3.830152,-3.844786,-3.874062,-4.542548,-4.480263,-4.356997,-4.471702,-4.501522,-3.93564,-3.881458,-3.853171,-4.056845,-3.857972,-3.88769,-4.0423,-3.828583,-3.822999],[-73.336776,-73.378019,-73.338717,-73.385881,-73.413631,-73.340366,-73.322513,-73.329072,-73.345052,-73.40642,-73.374641,-73.362468,-73.391568,-73.361572,-73.384126,-73.433988,-73.39309,-73.469968,-73.423672,-73.445628,-73.47498,-73.453248,-73.402808,-73.454582,-73.415961,-73.448246,-73.487435,-73.47431,-73.483968,-73.479276,-73.466734,-73.548449,-73.426447,-73.395123,-73.497835,-73.49033,-73.462008,-73.451622,-73.546,-73.531539,-73.483562,-73.458473,-73.437879,-73.335523,-73.3394,-73.347699,-73.60862,-73.54581,-73.55276,-73.538462,-73.569425,-73.32016,-73.318977,-73.373493,-73.455098,-73.409216,-73.351417,-73.437658,-73.354973,-73.326179],0.1,null,null,{"interactive":true,"className":"","stroke":true,"color":["#440154","#440154","#440154","#440154","#440154","#440154","#440154","#3B528B","#3B528B","#440154","#3B528B","#3B528B","#440154","#3B528B","#3B528B","#21908D","#3B528B","#21908D","#21908D","#5DC863","#21908D","#5DC863","#5DC863","#5DC863","#5DC863","#5DC863","#FDE725","#5DC863","#FDE725","#FDE725","#FDE725","#FDE725","#5DC863","#5DC863","#5DC863","#5DC863","#5DC863","#FDE725","#FDE725","#FDE725","#5DC863","#5DC863","#FDE725","#440154","#440154","#440154","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#3B528B","#440154","#440154","#21908D","#440154","#440154","#21908D","#440154","#440154"],"weight":5,"opacity":1,"fill":true,"fillColor":["#440154","#440154","#440154","#440154","#440154","#440154","#440154","#3B528B","#3B528B","#440154","#3B528B","#3B528B","#440154","#3B528B","#3B528B","#21908D","#3B528B","#21908D","#21908D","#5DC863","#21908D","#5DC863","#5DC863","#5DC863","#5DC863","#5DC863","#FDE725","#5DC863","#FDE725","#FDE725","#FDE725","#FDE725","#5DC863","#5DC863","#5DC863","#5DC863","#5DC863","#FDE725","#FDE725","#FDE725","#5DC863","#5DC863","#FDE725","#440154","#440154","#440154","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#3B528B","#440154","#440154","#21908D","#440154","#440154","#21908D","#440154","#440154"],"fillOpacity":0.5},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["CartoDB","OpenStreetMap","Satelital"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addLegend","args":[{"colors":["#440154","#3B528B","#21908D","#5DC863","#FDE725"],"labels":["1","2","3","4","5"],"na_color":null,"na_label":"NA","opacity":1,"position":"bottomright","type":"factor","title":"Cluster","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[-4.542548,-3.822999],"lng":[-73.60862,-73.318977]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>We see that the population centers seem to group, showing a strong spatial component driving the clustering.</p>
</section>
</section>
<section id="principal-components-analysis" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="principal-components-analysis"><span class="header-section-number">3.3</span> Principal components analysis</h3>
<p>Principal component analysis (PCA) was used as an alternative method for clustering. Our approach was to use the principal component to build an aggregate index of all the variables considered. Then, the scores of the populated centers on this principal component were grouped into different categories according to the quantiles of the distribution. In order to compare this approach with the results of hierarchical clustering, we tested with 4 (25th, 50th and 75th quantiles) and 5 (20th, 40th, 60th and 80th quantiles) groups.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform PCA</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">=</span> FactoMineR<span class="sc">::</span><span class="fu">PCA</span>(variables_std, <span class="at">graph =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="scree-plot" class="level4" data-number="3.3.1">
<h4 data-number="3.3.1" class="anchored" data-anchor-id="scree-plot"><span class="header-section-number">3.3.1</span> Scree plot</h4>
<p>After having performed the PCA, we plotted the scree plot to check the percentage of explained variance each component or dimension.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>pca <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fviz_screeplot</span>() <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that the first component explain approximately 50% of the variance in the data. This is not such a high value, meaning that the variables do not seem to be strongly linearly correlated. Still, 50% is an acceptable value in practice.</p>
</section>
<section id="contribution-plot" class="level4" data-number="3.3.2">
<h4 data-number="3.3.2" class="anchored" data-anchor-id="contribution-plot"><span class="header-section-number">3.3.2</span> Contribution plot</h4>
<p>Next, we plotted the top 10 variables according to their contribution to the first component.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pca <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fviz_contrib</span>(<span class="at">choice =</span> <span class="st">"var"</span>, <span class="at">axes =</span> <span class="dv">1</span>, <span class="at">top =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that the soil moisture, precipitation and runoff variables are the ones that contribute the most to explaining the first component.</p>
</section>
<section id="pca-groups-on-maps" class="level4" data-number="3.3.3">
<h4 data-number="3.3.3" class="anchored" data-anchor-id="pca-groups-on-maps"><span class="header-section-number">3.3.3</span> PCA groups on maps</h4>
<p>Finally, we created the groups dividing the population centers according to the quantiles of the scores on the principal component. Then we plotted the population centers on maps for 2, 3 and 4 groups.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get scores</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>pca_results <span class="ot">=</span> <span class="fu">get_pca_ind</span>(pca)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">=</span> pca_results<span class="sc">$</span>coord</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create groups by quantile categorization</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>ccpp_strata <span class="ot">=</span> ccpp_clusters <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pca_score =</span> scores[, <span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pca_group_4 =</span> <span class="fu">cut</span>(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>      pca_score, <span class="at">breaks =</span> <span class="fu">quantile</span>(pca_score, <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, <span class="dv">1</span>)), </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">rev</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pca_group_5 =</span> <span class="fu">cut</span>(</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>      pca_score, <span class="at">breaks =</span> <span class="fu">quantile</span>(pca_score, <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">2</span>, .<span class="dv">4</span>, .<span class="dv">6</span>, .<span class="dv">8</span>, <span class="dv">1</span>)), </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">rev</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)),</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(pca_group_4<span class="sc">:</span>pca_group_5, forcats<span class="sc">::</span>fct_rev))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">4 groups</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">5 groups</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Palette for 4 groups</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>palette_pca_4 <span class="ot">=</span> <span class="fu">colorFactor</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"viridis"</span>, <span class="at">domain =</span> ccpp_strata<span class="sc">$</span>pca_group_4</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot cluster map</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cluster_map</span>(ccpp_strata, palette_pca_4, pca_group_4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9cb7171fdb837a739b1c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-9cb7171fdb837a739b1c">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["CartoDB",null,"CartoDB",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelital",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[-3.863147,-3.831725,-3.856809,-3.84476,-3.906268,-3.915436,-3.898959,-3.944115,-3.95913,-3.954165,-3.938261,-3.94906,-3.931736,-3.966216,-3.978227,-4.01441,-4.003298,-4.00331,-4.02111,-4.071663,-4.064827,-4.094611,-4.103035,-4.103997,-4.127523,-4.123837,-4.230846,-4.154149,-4.219298,-4.203191,-4.223144,-4.246472,-4.05018,-4.082073,-4.126287,-4.162137,-4.15309,-4.2224,-4.260209,-4.330362,-4.121844,-4.14977,-4.179054,-3.830152,-3.844786,-3.874062,-4.542548,-4.480263,-4.356997,-4.471702,-4.501522,-3.93564,-3.881458,-3.853171,-4.056845,-3.857972,-3.88769,-4.0423,-3.828583,-3.822999],[-73.336776,-73.378019,-73.338717,-73.385881,-73.413631,-73.340366,-73.322513,-73.329072,-73.345052,-73.40642,-73.374641,-73.362468,-73.391568,-73.361572,-73.384126,-73.433988,-73.39309,-73.469968,-73.423672,-73.445628,-73.47498,-73.453248,-73.402808,-73.454582,-73.415961,-73.448246,-73.487435,-73.47431,-73.483968,-73.479276,-73.466734,-73.548449,-73.426447,-73.395123,-73.497835,-73.49033,-73.462008,-73.451622,-73.546,-73.531539,-73.483562,-73.458473,-73.437879,-73.335523,-73.3394,-73.347699,-73.60862,-73.54581,-73.55276,-73.538462,-73.569425,-73.32016,-73.318977,-73.373493,-73.455098,-73.409216,-73.351417,-73.437658,-73.354973,-73.326179],0.1,null,null,{"interactive":true,"className":"","stroke":true,"color":["#440154","#440154","#440154","#440154","#31688E","#31688E","#440154","#31688E","#31688E","#31688E","#31688E","#31688E","#440154","#31688E","#31688E","#31688E","#31688E","#31688E","#31688E","#35B779","#35B779","#35B779","#35B779","#35B779","#FDE725","#35B779","#FDE725","#35B779","#FDE725","#FDE725","#FDE725","#FDE725","#35B779","#35B779","#35B779","#35B779","#35B779","#FDE725","#FDE725","#FDE725","#35B779","#35B779","#FDE725","#440154","#440154","#440154","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#31688E","#440154","#440154","#35B779","#440154","#440154","#31688E","#440154","#440154"],"weight":5,"opacity":1,"fill":true,"fillColor":["#440154","#440154","#440154","#440154","#31688E","#31688E","#440154","#31688E","#31688E","#31688E","#31688E","#31688E","#440154","#31688E","#31688E","#31688E","#31688E","#31688E","#31688E","#35B779","#35B779","#35B779","#35B779","#35B779","#FDE725","#35B779","#FDE725","#35B779","#FDE725","#FDE725","#FDE725","#FDE725","#35B779","#35B779","#35B779","#35B779","#35B779","#FDE725","#FDE725","#FDE725","#35B779","#35B779","#FDE725","#440154","#440154","#440154","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#31688E","#440154","#440154","#35B779","#440154","#440154","#31688E","#440154","#440154"],"fillOpacity":0.5},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["CartoDB","OpenStreetMap","Satelital"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addLegend","args":[{"colors":["#440154","#31688E","#35B779","#FDE725"],"labels":["1","2","3","4"],"na_color":null,"na_label":"NA","opacity":1,"position":"bottomright","type":"factor","title":"Cluster","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[-4.542548,-3.822999],"lng":[-73.60862,-73.318977]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Palette for 5 groups</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>palette_pca_5 <span class="ot">=</span> <span class="fu">colorFactor</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"viridis"</span>, <span class="at">domain =</span> ccpp_strata<span class="sc">$</span>pca_group_5</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot cluster map</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cluster_map</span>(ccpp_strata, palette_pca_5, pca_group_5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d39341c286cb345349d0" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d39341c286cb345349d0">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["CartoDB",null,"CartoDB",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelital",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[-3.863147,-3.831725,-3.856809,-3.84476,-3.906268,-3.915436,-3.898959,-3.944115,-3.95913,-3.954165,-3.938261,-3.94906,-3.931736,-3.966216,-3.978227,-4.01441,-4.003298,-4.00331,-4.02111,-4.071663,-4.064827,-4.094611,-4.103035,-4.103997,-4.127523,-4.123837,-4.230846,-4.154149,-4.219298,-4.203191,-4.223144,-4.246472,-4.05018,-4.082073,-4.126287,-4.162137,-4.15309,-4.2224,-4.260209,-4.330362,-4.121844,-4.14977,-4.179054,-3.830152,-3.844786,-3.874062,-4.542548,-4.480263,-4.356997,-4.471702,-4.501522,-3.93564,-3.881458,-3.853171,-4.056845,-3.857972,-3.88769,-4.0423,-3.828583,-3.822999],[-73.336776,-73.378019,-73.338717,-73.385881,-73.413631,-73.340366,-73.322513,-73.329072,-73.345052,-73.40642,-73.374641,-73.362468,-73.391568,-73.361572,-73.384126,-73.433988,-73.39309,-73.469968,-73.423672,-73.445628,-73.47498,-73.453248,-73.402808,-73.454582,-73.415961,-73.448246,-73.487435,-73.47431,-73.483968,-73.479276,-73.466734,-73.548449,-73.426447,-73.395123,-73.497835,-73.49033,-73.462008,-73.451622,-73.546,-73.531539,-73.483562,-73.458473,-73.437879,-73.335523,-73.3394,-73.347699,-73.60862,-73.54581,-73.55276,-73.538462,-73.569425,-73.32016,-73.318977,-73.373493,-73.455098,-73.409216,-73.351417,-73.437658,-73.354973,-73.326179],0.1,null,null,{"interactive":true,"className":"","stroke":true,"color":["#440154","#440154","#440154","#440154","#3B528B","#3B528B","#3B528B","#21908D","#21908D","#3B528B","#3B528B","#3B528B","#3B528B","#3B528B","#3B528B","#21908D","#21908D","#3B528B","#21908D","#21908D","#21908D","#21908D","#5DC863","#21908D","#5DC863","#5DC863","#FDE725","#5DC863","#FDE725","#5DC863","#FDE725","#FDE725","#21908D","#5DC863","#5DC863","#5DC863","#5DC863","#FDE725","#FDE725","#FDE725","#5DC863","#5DC863","#5DC863","#440154","#440154","#440154","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#3B528B","#440154","#440154","#21908D","#3B528B","#440154","#21908D","#440154","#440154"],"weight":5,"opacity":1,"fill":true,"fillColor":["#440154","#440154","#440154","#440154","#3B528B","#3B528B","#3B528B","#21908D","#21908D","#3B528B","#3B528B","#3B528B","#3B528B","#3B528B","#3B528B","#21908D","#21908D","#3B528B","#21908D","#21908D","#21908D","#21908D","#5DC863","#21908D","#5DC863","#5DC863","#FDE725","#5DC863","#FDE725","#5DC863","#FDE725","#FDE725","#21908D","#5DC863","#5DC863","#5DC863","#5DC863","#FDE725","#FDE725","#FDE725","#5DC863","#5DC863","#5DC863","#440154","#440154","#440154","#FDE725","#FDE725","#FDE725","#FDE725","#FDE725","#3B528B","#440154","#440154","#21908D","#3B528B","#440154","#21908D","#440154","#440154"],"fillOpacity":0.5},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["CartoDB","OpenStreetMap","Satelital"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addLegend","args":[{"colors":["#440154","#3B528B","#21908D","#5DC863","#FDE725"],"labels":["1","2","3","4","5"],"na_color":null,"na_label":"NA","opacity":1,"position":"bottomright","type":"factor","title":"Cluster","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[-4.542548,-3.822999],"lng":[-73.60862,-73.318977]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>Geographically, the PCA groups seem to be distributed very similar to the HC groups.</p>
</section>
</section>
<section id="comparing-hc-and-pca" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="comparing-hc-and-pca"><span class="header-section-number">3.4</span> Comparing HC and PCA</h3>
<p>We assessed how strong was the agreement between the HC method and PCA method on the grouping of the population centers for 4 and 5 groups. Confusion matrices and the Kappa statistic were used for this analysis.</p>
<section id="confusion-matrices" class="level4" data-number="3.4.1">
<h4 data-number="3.4.1" class="anchored" data-anchor-id="confusion-matrices"><span class="header-section-number">3.4.1</span> Confusion matrices</h4>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">4 groups</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">5 groups</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ccpp_strata <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">conf_mat</span>(hc_group_4, pca_group_4, <span class="at">dnn =</span> <span class="fu">c</span>(<span class="st">"PCA"</span>, <span class="st">"HC"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">"heatmap"</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ccpp_strata <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  yardstick<span class="sc">::</span><span class="fu">conf_mat</span>(hc_group_5, pca_group_5, <span class="at">dnn =</span> <span class="fu">c</span>(<span class="st">"PCA"</span>, <span class="st">"HC"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">"heatmap"</span>) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="methodology_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get kappa statistic</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>kap_4 <span class="ot">=</span> yardstick<span class="sc">::</span><span class="fu">kap</span>(ccpp_strata, hc_group_4, pca_group_4)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>kap_5 <span class="ot">=</span> yardstick<span class="sc">::</span><span class="fu">kap</span>(ccpp_strata, hc_group_5, pca_group_5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>From the confusion matrices it is evident a moderate agreement between the HC method and the PCA method. The agreement is stronger with 4 groups (kappa = 0.87) than with and 5 (kappa = 0.67).</p>
<p>In summary, both 4 and 5 groups give very similar results in terms of visual and statistical indicators. However, we ultimately opted to work with 4 clusters to avoid an excessive disaggreation of populated centers.</p>
<div class="cell">

</div>
</section>
</section>
</section>
<section id="selection-of-populated-centers" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="selection-of-populated-centers"><span class="header-section-number">4</span> Selection of populated centers</h2>
<p>Having chosen the number of clusters, we determined the number of population centers we should select from each one of them to obtain a sample of 10 population centers with the same proportion of cases in each cluster.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample size for each cluster</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">table</span>(ccpp_strata<span class="sc">$</span>hc_group_4)<span class="sc">/</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
1 2 3 4 
3 2 2 2 </code></pre>
</div>
</div>
<p>Therefore, we needed to select roughly 3 populated centers from cluster 1 and 2 from each of the other ones.</p>
<p>We did not take a random sample approach since we had the following restraints:</p>
<ul>
<li>The Direccion Regional de Salud de Loreto (DIRESA Loreto) selected 5 population centers that are of epidemiological interest.</li>
<li>We had previously conducted field work to collect georeferenced points to reconstruct the perimeter of 21 populated centers. This is work that would have to be done for all the communities selected for drone mapping. So, for the sake of convenience, it was better to select from these population centers whose perimeters we already had.</li>
<li>We also filtered out those communities that required more than 3 hexagons of 1km2 area for drone flights.</li>
</ul>
<p>In the end, we were left with 24 populated centers (5 from DIRESA Loreto, 19 from InnovaLab), and we took these as our sampling frame. The 5 populated centers from DIRESA Loreto were a must and 4 of them were in cluster 1 and 1 in cluster 2, so from the InnovaLab collection we randomly sample 1 populated center from cluster 2 and 2 from clusters 3 and 4 to have a total sample size of 10.</p>
<p>The size and the percentage from the total of the clusters and the final sample are shown in the following table:</p>
<table class="table">
<thead>
<tr class="header">
<th>Cluster</th>
<th>Size</th>
<th>Sample size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>18 (30%)</td>
<td>4 (40%)</td>
</tr>
<tr class="even">
<td>2</td>
<td>14 (23.3%)</td>
<td>2 (20%)</td>
</tr>
<tr class="odd">
<td>3</td>
<td>14 (23.3%)</td>
<td>2 (20%)</td>
</tr>
<tr class="even">
<td>4</td>
<td>14 (23.3%)</td>
<td>2 (20%)</td>
</tr>
</tbody>
</table>
<div class="cell">

</div>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the 26 populated centers previously selected</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>raw_path <span class="ot">=</span> <span class="st">"data/raw/"</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>ccpp_previous_path <span class="ot">=</span> fs<span class="sc">::</span><span class="fu">path</span>(raw_path, <span class="st">"ccpp-perimeters-diresa.csv"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>ccpp_previous_ccpp <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(ccpp_previous_path, <span class="at">col_types =</span> <span class="st">"cccccccd"</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>ccpp_previous_strata <span class="ot">=</span> <span class="fu">filter</span>(</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  ccpp_strata, ubigeocp <span class="sc">%in%</span> ccpp_previous_ccpp<span class="sc">$</span>UBIGEOCP</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Select from DIRESA Loreto selection</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>ccpp_sample_diresa <span class="ot">=</span> ccpp_previous_strata <span class="sc">%&gt;%</span> </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">"DIRESA"</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Select from InnovaLab collection</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>n_samples_innova <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>ccpp_sample_innova <span class="ot">=</span> ccpp_previous_strata <span class="sc">%&gt;%</span> </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">"INNOVALAB"</span>, hc_group_4 <span class="sc">!=</span> <span class="st">"1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">nest</span>(<span class="at">data =</span> <span class="sc">-</span>hc_group_4) <span class="sc">%&gt;%</span> </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(data, n_samples_innova, <span class="sc">~</span><span class="fu">slice_sample</span>(.x, <span class="at">n =</span> .y))</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hc_group_4, sample) <span class="sc">%&gt;%</span> </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(sample) <span class="sc">%&gt;%</span> </span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(hc_group_4, <span class="at">.before =</span>  hc_group_5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>group_3_sample <span class="ot">=</span> ccpp_previous_strata <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hc_group_4 <span class="sc">==</span> <span class="st">"3"</span>, <span class="sc">!</span>(nomcp <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"HUAMBE"</span>, <span class="st">"23 DE FEBRERO"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>ccpp_sample_innova_new <span class="ot">=</span> <span class="fu">filter</span>(ccpp_sample_innova, nomcp <span class="sc">!=</span> <span class="st">"HUAMBE"</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Final sample</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>ccpp_sample <span class="ot">=</span> <span class="fu">bind_rows</span>(</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  ccpp_sample_innova_new, group_3_sample, ccpp_sample_diresa</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">

</div>
<div class="cell">

</div>
<div class="cell">

</div>
<p>Finally, we plot the samples in a map to see their geographical distribution.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinates of all the population centers</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>ccpp_coord <span class="ot">=</span> ccpp_strata <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinates of the 10 samples</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>ccpp_sample_coord <span class="ot">=</span> ccpp_sample <span class="sc">%&gt;%</span> </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot the samples on a map</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>sample_map <span class="ot">=</span> <span class="cf">function</span>(data, palette, group_var) {</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  values <span class="ot">=</span> <span class="fu">pull</span>(data, {{group_var}})</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  map <span class="ot">=</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addTiles</span>(<span class="at">group =</span> <span class="st">"OpenStreetMap"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addProviderTiles</span>(<span class="at">provider =</span> providers<span class="sc">$</span>CartoDB, <span class="at">group =</span> <span class="st">"CartoDB"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addProviderTiles</span>(</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">provider =</span> providers<span class="sc">$</span>Esri.WorldImagery,<span class="at">group =</span> <span class="st">"Satelital"</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addCircleMarkers</span>(</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ccpp_coord, <span class="at">opacity =</span> <span class="dv">1</span>, <span class="at">radius =</span> <span class="fl">0.1</span>, <span class="at">fillOpacity =</span> <span class="fl">0.5</span>, </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"lightgray"</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addCircleMarkers</span>(</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">popup =</span> data<span class="sc">$</span>population_center, <span class="at">color =</span> <span class="sc">~</span><span class="fu">palette</span>(values),</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">opacity =</span> <span class="dv">1</span>, <span class="at">radius =</span> <span class="fl">0.1</span>, <span class="at">fillOpacity =</span> <span class="fl">0.5</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>      )<span class="sc">%&gt;%</span> </span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"CartoDB"</span>,<span class="st">"OpenStreetMap"</span>, <span class="st">"Satelital"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addLegend</span>(</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Cluster"</span>, <span class="at">pal =</span> palette, <span class="at">values =</span> values, <span class="at">opacity =</span> <span class="dv">1</span>,</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">position =</span> <span class="st">"bottomright"</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  map</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Palette for the sample</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>sample_palette <span class="ot">=</span> <span class="fu">colorFactor</span>(</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"viridis"</span>, <span class="at">domain =</span> ccpp_sample<span class="sc">$</span>hc_group_4</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Map the samples</span></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_map</span>(ccpp_sample, sample_palette, hc_group_4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cb02b990b6aff215c866" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-cb02b990b6aff215c866">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["CartoDB",null,"CartoDB",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelital",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[-3.863147,-3.831725,-3.856809,-3.84476,-3.906268,-3.915436,-3.898959,-3.944115,-3.95913,-3.954165,-3.938261,-3.94906,-3.931736,-3.966216,-3.978227,-4.01441,-4.003298,-4.00331,-4.02111,-4.071663,-4.064827,-4.094611,-4.103035,-4.103997,-4.127523,-4.123837,-4.230846,-4.154149,-4.219298,-4.203191,-4.223144,-4.246472,-4.05018,-4.082073,-4.126287,-4.162137,-4.15309,-4.2224,-4.260209,-4.330362,-4.121844,-4.14977,-4.179054,-3.830152,-3.844786,-3.874062,-4.542548,-4.480263,-4.356997,-4.471702,-4.501522,-3.93564,-3.881458,-3.853171,-4.056845,-3.857972,-3.88769,-4.0423,-3.828583,-3.822999],[-73.336776,-73.378019,-73.338717,-73.385881,-73.413631,-73.340366,-73.322513,-73.329072,-73.345052,-73.40642,-73.374641,-73.362468,-73.391568,-73.361572,-73.384126,-73.433988,-73.39309,-73.469968,-73.423672,-73.445628,-73.47498,-73.453248,-73.402808,-73.454582,-73.415961,-73.448246,-73.487435,-73.47431,-73.483968,-73.479276,-73.466734,-73.548449,-73.426447,-73.395123,-73.497835,-73.49033,-73.462008,-73.451622,-73.546,-73.531539,-73.483562,-73.458473,-73.437879,-73.335523,-73.3394,-73.347699,-73.60862,-73.54581,-73.55276,-73.538462,-73.569425,-73.32016,-73.318977,-73.373493,-73.455098,-73.409216,-73.351417,-73.437658,-73.354973,-73.326179],0.1,null,null,{"interactive":true,"className":"","stroke":true,"color":"lightgray","weight":5,"opacity":1,"fill":true,"fillColor":"lightgray","fillOpacity":0.5},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[[-3.95913,-4.14977,-4.219298,-4.179054,-4.103997,-3.857972,-3.88769,-4.0423,-3.828583,-3.822999],[-73.345052,-73.458473,-73.483968,-73.437879,-73.454582,-73.409216,-73.351417,-73.437658,-73.354973,-73.326179],0.1,null,null,{"interactive":true,"className":"","stroke":true,"color":["#31688E","#35B779","#FDE725","#FDE725","#35B779","#440154","#440154","#31688E","#440154","#440154"],"weight":5,"opacity":1,"fill":true,"fillColor":["#31688E","#35B779","#FDE725","#FDE725","#35B779","#440154","#440154","#31688E","#440154","#440154"],"fillOpacity":0.5},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["CartoDB","OpenStreetMap","Satelital"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addLegend","args":[{"colors":["#440154","#31688E","#35B779","#FDE725"],"labels":["1","2","3","4"],"na_color":null,"na_label":"NA","opacity":1,"position":"bottomright","type":"factor","title":"Cluster","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[-4.542548,-3.822999],"lng":[-73.60862,-73.318977]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-boehmke2019hands" class="csl-entry" role="doc-biblioentry">
Boehmke, Brad, and Brandon Greenwell. 2019. <em>Hands-on Machine Learning with r</em>. Chapman; Hall/CRC.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>